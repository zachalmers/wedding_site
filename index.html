<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>#ChalmedByPatel</title>
  <meta name="description" content="Share your contact details for Umangi & Zach's wedding on December 4‚Äì6, 2026." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="assets/styles.css?v=20250814" />
</head>
<body>
  <div class="bg" id="bg"></div>
  <div class="grain" aria-hidden="true"></div>
  <section class="hero" aria-label="Oaxaca City ‚Äî background slideshow">
    <!-- Splash header stacked above the form -->
    <div class="splash" aria-label="Save the Date">
      <div class="line1">Save the Date</div>
      <div class="line2">December 4‚Äì6, 2026</div>
      <div class="line3">Oaxaca City, Mexico</div>
    </div>

    <main class="card" role="main" aria-labelledby="title">
      <header>
        <div class="brand">
          <div class="monogram" aria-hidden="true">U ¬∑ Z</div>
          <div>
            <h1 id="title">Share your contact details</h1>
            <div class="sub">for <strong>Umangi & Zach‚Äôs</strong> wedding</div>
          </div>
        </div>
      </header>

      <form id="contact-form" novalidate autocomplete="on">
        <input type="text" name="company" id="company" autocomplete="organization" style="position:absolute;left:-9999px;top:-9999px" tabindex="-1" aria-hidden="true" />

        <div>
          <label class="sr-only" for="firstName">Your first name *</label>
          <input id="firstName" name="firstName" type="text" autocomplete="given-name" autocapitalize="words" placeholder="First name *" required />
        </div>
        <div>
          <label class="sr-only" for="lastName">Your last name *</label>
          <input id="lastName" name="lastName" type="text" autocomplete="family-name" autocapitalize="words" placeholder="Last name *" required />
        </div>

        <div>
          <label class="sr-only" for="email">Email *</label>
          <input id="email" name="email" type="email" autocomplete="email" inputmode="email" placeholder="Email *" required />
        </div>
        <div>
          <label class="sr-only" for="phone">Mobile phone</label>
          <input id="phone" name="phone" type="tel" autocomplete="tel" inputmode="tel" placeholder="Mobile phone" />
        </div>

        <div class="full">
          <label class="sr-only" for="address1">Street address *</label>
          <input id="address1" name="address1" type="text" autocomplete="street-address" placeholder="Street address *" required />
        </div>
        <div>
          <label class="sr-only" for="address2">Apt / Unit</label>
          <input id="address2" name="address2" type="text" autocomplete="address-line2" placeholder="Apt / Unit" />
        </div>
        <div>
          <label class="sr-only" for="city">City *</label>
          <input id="city" name="city" type="text" autocomplete="address-level2" placeholder="City *" required />
        </div>
        <div>
          <label class="sr-only" for="state">State / Province *</label>
          <input id="state" name="state" type="text" autocomplete="address-level1" placeholder="State / Province *" required />
        </div>
        <div>
          <label class="sr-only" for="zip">Postal code *</label>
          <input id="zip" name="zip" type="text" autocomplete="postal-code" placeholder="Postal code *" required />
        </div>
        <div>
          <label class="sr-only" for="country">Country *</label>
                    <input id="country" name="country-name" type="text" autocomplete="country-name" placeholder="Country *" value="United States" required />
        </div>

        <div class="full">
          <label id="members-label" class="field-label-lg">
            Other members of your party? <span class="tiny">(Optional)</span>
          </label>
          <div class="members" id="members">
            <div class="member" data-key="1">
              <div class="member-row">
                <div>
                  <label class="sr-only" for="member-1-fn">First name</label>
                  <input id="member-1-fn" name="members[0].firstName" type="text" placeholder="First name" />
                </div>
                <div>
                  <label class="sr-only" for="member-1-ln">Last name</label>
                  <input id="member-1-ln" name="members[0].lastName" type="text" placeholder="Last name" />
                </div>
                <label class="chk" for="member-1-child">
                  <input type="checkbox" id="member-1-child" name="members[0].child" /> Child
                </label>
                <button type="button" class="btn secondary icon remove-btn" aria-label="Remove person" title="Remove">√ó</button>
              </div>
            </div>
          </div>
          <div class="actions actions-right">
            <button class="btn secondary" id="add-member" type="button">+ Add another person</button>
          </div>
        </div>

        <div class="full">
          <label for="likelihood" style="font-size:18px;font-weight:500;color:var(--text);letter-spacing:.1px">Do you think you‚Äôll be able to attend? <span class="tiny">(Not an RSVP, vibes only)</span></label>
          <div class="slider-row">
            <span class="tiny emoji">ü§∑</span>
            <div class="slider-col">
              <input id="likelihood" name="likelihood" type="range" min="1" max="5" step="1" value="3" aria-label="Likelihood to attend (1-5)" />
              <!-- Lock labels to exact slider percentages -->
              <div class="scale-grid" aria-hidden="true">
                <span class="s0">Unlikely</span>
                <span class="s25">Maybe</span>
                <span class="s50">Probably</span>
                <span class="s75">Likely</span>
                <span class="s100">Definitely</span>
              </div>
            </div>
            <span class="tiny emoji">üéâ</span>
          </div>
        </div>


        <div class="full">
          <label class="sr-only" for="note">Anything we should know?</label>
          <textarea id="note" name="note" rows="3" placeholder="Anything we should know? (dietary needs, travel constraints, etc.)"></textarea>
        </div>

        <div class="full actions actions-right">
          <span id="inline-status" class="status-text" aria-live="polite"></span>
          <button class="btn secondary" type="submit" id="submit" aria-live="polite">
            <span class="btn-label">Submit</span>
            <span class="spinner" aria-hidden="true" hidden></span>
          </button>
        </div>
      </form>

    </main>
  </section>

  <section class="faq-card">
    <section class="faq" aria-labelledby="faq-title">
      <h2 id="faq-title">FAQs</h2>
      <details>
        <summary>Is this an RSVP?</summary>
        <div class="answer tiny">Nope! This is to collect your contact details and get a vibe on headcount. Formal invites + RSVP to follow.</div>
      </details>
      <details>
        <summary>Are kids welcome?</summary>
        <div class="answer tiny">While a parents‚Äô getaway is encouraged, children and families are warmly welcomed. For those traveling as a family, we‚Äôll share childcare suggestions and kid-friendly ideas to make the trip enjoyable for everyone.</div>
      </details>
      <details>
        <summary>When and where?</summary>
        <div class="answer tiny">Festivities will begin in Oaxaca City the evening of Friday December 4th, 2026 and conclude Sunday morning.</div>
      </details>
      <details>
        <summary>Getting to Oaxaca?</summary>
        <div class="answer tiny">OAX can be reached via nonstop flights from LAX, IAH, and DFW in the U.S., and via MEX or MTY in Mexico. We encourage you to explore Mexico before or after the wedding, and we‚Äôll share some personal travel recommendations!</div>
      </details>
      <details>
        <summary>Where to Stay?</summary>
        <div class="answer tiny">Oaxaca City is a town full of stunning boutique hotels and haciendas plucked from the pages of Architectural Digest. They offer incredible value at every price point. We'll highlight some of our faves.</div>
      </details>
            <details>
        <summary>More questions?</summary>
        <div class="answer tiny">Shoot us a message! Zach - zachalmers@gmail.com Umangi - umangipatel7@gmail.com </div>
      </details>
    </section>
  </section>

  <footer>
    <span>¬© <span id="year"></span> Umangi &amp; Zach | Designed with ‚ù§Ô∏è in SF</span>
  </footer>
  <div class="footer-spacer" aria-hidden="true"></div>

  <script>
  (()=>{
    // ===== Background Slideshow (Ken Burns-style) using local assets =====
    const bg = document.getElementById('bg');

    // --- Discover background photos ---
    // 1) Prefer a ./assets/photos.json manifest (validated),
    // 2) Otherwise probe common name patterns (.jpeg/.jpg) and keep only existing files.
    async function discoverPhotos(){
      // Preferred: a manifest if present; validate entries actually load
      try{
        const res = await fetch('./assets/photos.json', { cache: 'no-store' });
        if(res.ok){
          const list = await res.json();
          if (Array.isArray(list) && list.length){
            const normalized = list.map(p => p.startsWith('./') ? p : (p.startsWith('assets/') ? `./${p}` : `./assets/${p}`));
            const existing = await preloadExisting(normalized);
            if (existing.length) return existing;
          }
        }
      }catch{}

      // Fallback: probe common filename patterns (validate existence)
      const patterns = [
        i => `./assets/bg${i}.jpeg`,
        i => `./assets/photo${i}.jpeg`,
        i => `./assets/img${i}.jpeg`,
        i => `./assets/bg${i}.jpg`,
        i => `./assets/photo${i}.jpg`,
        i => `./assets/img${i}.jpg`,
      ];
      const max = 60; // try up to 60 per pattern to allow growth
      const candidates = [];
      for (const pat of patterns){
        for (let i=1;i<=max;i++) candidates.push(pat(i));
      }
      return await preloadExisting(candidates);
    }

    // Preload a list of candidate URLs and return only those that actually load.
    function preloadExisting(srcs){
      return new Promise(resolve => {
        const found = [];
        let pending = srcs.length;
        if (pending === 0) return resolve(found);
        srcs.forEach(src => {
          const img = new Image();
          img.onload = () => { found.push(src); if(--pending===0) resolve(found); };
          img.onerror = () => { if(--pending===0) resolve(found); };
          img.src = src;
        });
      });
    }

    // Fisher‚ÄìYates shuffle (in-place) for random slide order.
    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr;
    }

    // Initialize slideshow: set first slide, start Ken Burns, then advance every 10s.
    (async function initSlideshow(){
      let photos = await discoverPhotos();
      if(!photos || photos.length===0){
        // final fallback: original three
        photos = ['./assets/bg1.jpeg','./assets/bg2.jpeg','./assets/bg3.jpeg'];
      }
      shuffle(photos);

      const positions = ['center top','left center','center bottom','right center','center center'];
      let slideIndex = 0;

      function setSlide(idx){
        const src = photos[idx % photos.length];
        const pos = positions[Math.floor(Math.random()*positions.length)];
        bg.style.backgroundImage = `url(${src})`;
        bg.style.backgroundPosition = pos;
      }

      // Start state
      setSlide(slideIndex);
      setTimeout(()=> bg.classList.add('kb-zoom'), 10);

      function nextBg(){
        slideIndex = (slideIndex + 1) % photos.length;
        bg.style.transition = 'opacity 1s, transform 18s ease, background-position 18s ease, background-image 600ms ease';
        bg.style.opacity = 0.3;
        setTimeout(()=>{
          bg.classList.remove('kb-zoom');
          setSlide(slideIndex);
          void bg.offsetWidth; // reflow to restart animation
          bg.classList.add('kb-zoom');
          bg.style.transition = 'opacity 1.2s, transform 18s ease, background-position 18s ease, background-image 600ms ease';
          bg.style.opacity = 1;
        }, 350);
      }

      const interval = setInterval(nextBg, 10000); // every 10 seconds
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches){
        clearInterval(interval);
        bg.classList.remove('kb-zoom');
      }
    })();

    // ===== Year =====
    document.getElementById('year').textContent=new Date().getFullYear();

    // ===== Members dynamic rows =====
    const members=document.getElementById('members');
    const addMemberBtn=document.getElementById('add-member');
    const membersLabel=document.getElementById('members-label');
    let memberKey=1;

    function newMember(indexForName){
      memberKey+=1; const key=memberKey;
      const wrap=document.createElement('div');
      wrap.className='member'; wrap.dataset.key=String(key);
      wrap.innerHTML=`
        <div class="member-row">
          <div>
            <label class="sr-only" for="member-${key}-fn">First name</label>
            <input id="member-${key}-fn" name="members[${indexForName}].firstName" type="text" placeholder="First name" />
          </div>
          <div>
            <label class="sr-only" for="member-${key}-ln">Last name</label>
            <input id="member-${key}-ln" name="members[${indexForName}].lastName" type="text" placeholder="Last name" />
          </div>
          <label class="chk" for="member-${key}-child">
            <input type="checkbox" id="member-${key}-child" name="members[${indexForName}].child" /> Child
          </label>
          <button type="button" class="btn secondary icon remove-btn" aria-label="Remove person" title="Remove">√ó</button>
        </div>`;
      return wrap;
    }

    function renumberNames(){
      const rows=Array.from(document.querySelectorAll('.members .member'));
      rows.forEach((row,idx)=>{
        row.querySelectorAll('input').forEach(inp=>{
          if (inp.name && inp.name.includes('members[')){
            const suffix=inp.name.split('].').pop();
            inp.name=`members[${idx}].${suffix}`;
          }
        });
      });
      if(membersLabel){membersLabel.style.display=rows.length===0?'none':''}
    }

    function removeMember(node){ if(!node) return; node.remove(); renumberNames(); }

    addMemberBtn.addEventListener('click',()=>{ const current=members.querySelectorAll('.member').length; const row=newMember(current); members.appendChild(row); renumberNames(); });
    members.addEventListener('click', (e)=>{ const btn=e.target.closest('.remove-btn'); if(!btn) return; const node=btn.closest('.member'); removeMember(node); });
    document.addEventListener('DOMContentLoaded', renumberNames);

    // ===== Submission (front-end only) =====
    const FORM_ENDPOINT = "https://script.google.com/macros/s/AKfycbw2fzKTHn9hdWClRQaopSRz4B2YAT-NYW08e4h22vrepHXszNFnzS64oC2QrDuVbHg7/exec";
    const form=document.getElementById('contact-form');
    const status=document.getElementById('inline-status');
    const submitBtn = document.getElementById('submit');
    const submitLabel = submitBtn.querySelector('.btn-label');
    const submitSpin = submitBtn.querySelector('.spinner');
    let isSubmitting = false;
    function setStatus(type,msg){
      if(!status) return;
      status.textContent = msg || '';
      status.classList.remove('error','success');
      if(type) status.classList.add(type);
    }

    // Build payload from form controls, plus derived counts for the sheet.
    function collectData(){
      const membersData = Array.from(document.querySelectorAll('.members .member')).map((el)=>({
        firstName: (el.querySelector('input[name$=".firstName"]').value || '').trim(),
        lastName: (el.querySelector('input[name$=".lastName"]').value || '').trim(),
        isChild: !!el.querySelector('input[name$=".child"]').checked,
      })).filter(m => m.firstName || m.lastName);

      // === Derived values for backend ===
      const namedMembers = membersData; // already filtered for non-empty names
      const adultMembers = namedMembers.filter(m => !m.isChild);
      const childMembers = namedMembers.filter(m => m.isChild);
      const adultCount = 1 + adultMembers.length; // includes principal as an adult
      const childCount = childMembers.length;
      const othersNames = namedMembers
        .map(m => `${m.firstName} ${m.lastName}`.trim())
        .filter(Boolean)
        .join(', ');

      return {
        ts: new Date().toISOString(),
        source: 'oaxaca-contact-capture',
        couple: { bride: 'Umangi', groom: 'Zach' },
        principal: {
          firstName: document.getElementById('firstName').value.trim(),
          lastName: document.getElementById('lastName').value.trim(),
          email: document.getElementById('email').value.trim(),
          phone: document.getElementById('phone').value.trim(),
          address1: document.getElementById('address1').value.trim(),
          address2: document.getElementById('address2').value.trim(),
          city: document.getElementById('city').value.trim(),
          state: document.getElementById('state').value.trim(),
          zip: document.getElementById('zip').value.trim(),
          country: document.getElementById('country').value.trim(),
        },
        members: membersData,
        // derived fields to help the Apps Script map to columns directly
        adultCount,
        childCount,
        othersNames,
        likelihood: Number(document.getElementById('likelihood').value),
        note: document.getElementById('note').value.trim(),
        notRSVP: true,
      };
    }

    // Minimal client-side validation; honeypot blocks bots.
    function validate(){
      const required=['firstName','lastName','email','address1','city','state','zip','country'];
      for(const id of required){ const el=document.getElementById(id); if(!el.value.trim()){ el.focus(); return false; } }
      const email=document.getElementById('email').value.trim();
      if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ document.getElementById('email').focus(); return false; }
      if(document.getElementById('company').value){ return false; } // honeypot
      return true;
    }

    // Post to Apps Script endpoint using a CORS-safelisted request.
    // In no-cors mode the response is opaque; success assumed on resolved fetch.
    async function postData(data){
      if(!FORM_ENDPOINT){
        console.warn('FORM_ENDPOINT is missing');
        return false;
      }
      try{
        const res = await fetch(FORM_ENDPOINT, {
          method: 'POST',
          // Use a CORS-safelisted content type + no-cors to avoid preflight and CORS blocking
          mode: 'no-cors',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify(data)
        });
        // In no-cors mode, the response is opaque; treat successful resolution as success
        console.log('Posted to GAS (opaque response expected in no-cors mode):', res && res.type);
        return true;
      }catch(err){
        console.error('POST failed:', err);
        return false;
      }
    }

    if (location.protocol === 'file:') {
      console.warn('Running from file:// origin. Using no-cors POST to avoid CORS errors. For full responses, serve via http(s) (e.g., VS Code Live Server).');
    }

    // Submit handler: block double-submits, show spinner, and reset on success.
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if (isSubmitting) return; // guard against double-clicks

      setStatus('', '');
      if(!validate()){
        setStatus('error','Please complete required fields.');
        return;
      }

      // lock UI
      isSubmitting = true;
      submitBtn.disabled = true;
      submitBtn.setAttribute('aria-busy','true');
      if (submitLabel) submitLabel.textContent = 'Submitting‚Ä¶';
      if (submitSpin) submitSpin.hidden = false;

      const payload = collectData();
      const sent = await postData(payload);

      if(sent){
        setStatus('success','Thank you! We‚Äôve saved your info. üéâ');
        if (submitLabel) submitLabel.textContent = 'Submitted';
        if (submitSpin) submitSpin.hidden = true;
        submitBtn.removeAttribute('aria-busy');
        // optional: keep disabled briefly to avoid more clicks, then re-enable
        setTimeout(()=>{ submitBtn.disabled = false; if (submitLabel) submitLabel.textContent = 'Submit'; }, 1200);
        form.reset();
        members.innerHTML='';
        const fallback=newMember(0);
        members.appendChild(fallback);
        renumberNames();
      } else {
        setStatus('error','Something went wrong. Please try again.');
        // unlock UI on failure
        if (submitLabel) submitLabel.textContent = 'Submit';
        if (submitSpin) submitSpin.hidden = true;
        submitBtn.removeAttribute('aria-busy');
        submitBtn.disabled = false;
      }

      isSubmitting = false;
    });

    // ===== Tiny self-tests (console only) =====
    (function runSelfTests(){
      const results=[]; const ok=(n,p)=>results.push({n,p});
      try{
        ok('Stacked layout', getComputedStyle(document.querySelector('.hero')).flexDirection==='column');
        ok('Slider default is numeric', Number(document.getElementById('likelihood').value)===3);
        ok('Child checkbox present', !!document.querySelector('input[name$=".child"]'));
        ok('Remove buttons present', document.querySelectorAll('.remove-btn').length>=1);
      }catch(e){ console.error('Self-tests crashed:', e); }
      console.groupCollapsed('Contact-capture self-tests');
      results.forEach(r=>console.log(`${r.p ? '‚úÖ' : '‚ùå'} ${r.n}`));
      console.groupEnd();
    })();
  })();
  </script>
</body>
</html>